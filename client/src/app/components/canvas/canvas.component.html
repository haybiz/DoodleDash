<div
  class="canvas-container relative w-full h-full bg-slate-900 rounded-xl shadow-2xl overflow-hidden glass-panel border border-slate-700 flex flex-col">

  <!-- Tools Header -->
  <div
    class="w-full p-4 flex gap-4 bg-slate-800/80 backdrop-blur z-10 border-b border-slate-700 justify-between items-center">
    <!-- Colors -->
    <div class="flex gap-2">
      @for (color of colors; track color) {
      <button class="w-8 h-8 rounded-full border-2 transition-transform shadow-md" [style.backgroundColor]="color"
        [class.border-white]="color === drawingService.currentColor"
        [class.border-transparent]="color !== drawingService.currentColor"
        [class.scale-110]="color === drawingService.currentColor" (click)="setColor(color)"></button>
      }
    </div>
    <!-- Layer Selector -->
    <div class="flex gap-1 bg-slate-900 overflow-hidden rounded-lg border border-slate-700 p-1">
      <button class="px-3 py-1 text-xs font-semibold uppercase tracking-widest rounded transition-colors"
        [class.bg-purple-600]="activeLayer === 'foreground'" [class.text-white]="activeLayer === 'foreground'"
        [class.text-slate-400]="activeLayer !== 'foreground'" [class.hover:bg-slate-800]="activeLayer !== 'foreground'"
        (click)="setLayer('foreground')">FG</button>
      <button class="px-3 py-1 text-xs font-semibold uppercase tracking-widest rounded transition-colors"
        [class.bg-purple-600]="activeLayer === 'background'" [class.text-white]="activeLayer === 'background'"
        [class.text-slate-400]="activeLayer !== 'background'" [class.hover:bg-slate-800]="activeLayer !== 'background'"
        (click)="setLayer('background')">BG</button>
    </div>

    <!-- Tool Selector -->
    <div class="flex gap-1 bg-slate-900 overflow-hidden rounded-lg border border-slate-700 p-1">
      <button class="px-3 py-1 text-sm font-medium rounded transition-colors"
        [class.bg-indigo-600]="drawingService.currentTool === 'brush'"
        [class.text-white]="drawingService.currentTool === 'brush'"
        [class.text-slate-400]="drawingService.currentTool !== 'brush'"
        [class.hover:bg-slate-800]="drawingService.currentTool !== 'brush'" (click)="setTool('brush')">ğŸ–Œï¸</button>
      <button class="px-3 py-1 text-sm font-medium rounded transition-colors"
        [class.bg-indigo-600]="drawingService.currentTool === 'line'"
        [class.text-white]="drawingService.currentTool === 'line'"
        [class.text-slate-400]="drawingService.currentTool !== 'line'"
        [class.hover:bg-slate-800]="drawingService.currentTool !== 'line'" (click)="setTool('line')">â–</button>
      <button class="px-3 py-1 text-sm font-medium rounded transition-colors"
        [class.bg-indigo-600]="drawingService.currentTool === 'rectangle'"
        [class.text-white]="drawingService.currentTool === 'rectangle'"
        [class.text-slate-400]="drawingService.currentTool !== 'rectangle'"
        [class.hover:bg-slate-800]="drawingService.currentTool !== 'rectangle'"
        (click)="setTool('rectangle')">ğŸ”²</button>
      <button class="px-3 py-1 text-sm font-medium rounded transition-colors"
        [class.bg-indigo-600]="drawingService.currentTool === 'circle'"
        [class.text-white]="drawingService.currentTool === 'circle'"
        [class.text-slate-400]="drawingService.currentTool !== 'circle'"
        [class.hover:bg-slate-800]="drawingService.currentTool !== 'circle'" (click)="setTool('circle')">â­•</button>
      <div class="w-px h-6 bg-slate-700 mx-1 self-center"></div>
      <button class="px-3 py-1 text-sm font-medium rounded transition-colors"
        [class.bg-indigo-600]="drawingService.currentTool === 'highlighter'"
        [class.text-white]="drawingService.currentTool === 'highlighter'"
        [class.text-slate-400]="drawingService.currentTool !== 'highlighter'"
        [class.hover:bg-slate-800]="drawingService.currentTool !== 'highlighter'"
        (click)="setTool('highlighter')">ğŸ–ï¸</button>
      <button class="px-3 py-1 text-sm font-medium rounded transition-colors"
        [class.bg-indigo-600]="drawingService.currentTool === 'spray'"
        [class.text-white]="drawingService.currentTool === 'spray'"
        [class.text-slate-400]="drawingService.currentTool !== 'spray'"
        [class.hover:bg-slate-800]="drawingService.currentTool !== 'spray'" (click)="setTool('spray')">ğŸ’¨</button>
    </div>

    <!-- Actions -->
    <div class="flex gap-2">
      <button
        class="bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded-lg text-sm font-semibold transition-colors disabled:opacity-50"
        (click)="undo()">
        <span class="mr-1">â†©ï¸</span> Undo
      </button>
      <button
        class="bg-red-900/30 hover:bg-red-900/60 text-red-100 border border-red-800/50 px-4 py-2 rounded-lg text-sm font-semibold transition-colors"
        (click)="clearCanvas()">
        <span class="mr-1">ğŸ—‘ï¸</span> Clear
      </button>
    </div>
  </div>
  <div class="flex-grow w-full relative">
    <!-- Background Layer (Z-index 0) -->
    <canvas #bgCanvas class="absolute top-0 left-0 w-full h-full pointer-events-none"></canvas>

    <!-- Foreground / Active Interaction Layer (Z-index 10) -->
    <canvas #drawCanvas class="absolute top-0 left-0 w-full h-full touch-none cursor-crosshair z-10"
      (mousedown)="onMouseDown($event)" (mousemove)="onMouseMove($event)" (mouseup)="onMouseUp()"
      (mouseleave)="onMouseUp()" (touchstart)="onTouchStart($event)" (touchmove)="onTouchMove($event)"
      (touchend)="onMouseUp()">
    </canvas>
  </div>
</div>